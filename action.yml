name: 'pwsh-module-build'
description: 'Builds a PowerShell Module using ModuleBuilder'
inputs:
  moduleName:
    description: 'Name of PowerShell Module to Test'
    required: true

runs:
  using: composite
  steps:
  - name: Download Build Output
    uses: actions/download-artifact@v2

  - uses: PoshCode/Actions/install-requiredmodules@v1
    with:
      requiredModules-path: ${{ github.workspace }}/RequiredModules/RequiredModules.psd1

  - name: PowerShell
    shell: pwsh
    run: |
      $contents = Get-Content -Path ${{ github.workspace }}/RequiredModules/RequiredModules.psd1
      Write-Host "Contents: $( $contents )"
      Get-Module -Name ImportExcel -ListAvailable

  - uses: PoshCode/Actions/pester@v1
    with:
      codeCoveragePath: Modules/${{ inputs.moduleName }}
      moduleUnderTest: ${{ inputs.moduleName }}
      additionalModulePaths: '${{github.workspace}}/Modules; ${{github.workspace}}/RequiredModules'

  - name: Upload Results
    uses: actions/upload-artifact@v2
    with:
      name: Pester Results
      path: ${{github.workspace}}/*.xml
